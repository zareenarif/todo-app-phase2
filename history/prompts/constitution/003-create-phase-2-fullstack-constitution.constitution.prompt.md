---
id: 003
title: Create Phase 2 Full-Stack Constitution
stage: constitution
date: 2026-01-05
surface: agent
model: claude-sonnet-4-5
feature: none
branch: main
user: DC
command: /sp.constitution
labels: ["phase-2", "full-stack", "architecture", "security", "authentication"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - .specify/memory/constitution.md
tests:
  - Manual constitutional compliance review
---

## Prompt

You are working on Hackathon II using Spec-Driven Development.

Phase Title:
"Todo Full-Stack Web Application "

Your task:
Generate a COMPLETE and FORMAL Phase 2 constitution.md file.

The constitution MUST strictly follow these rules:

Non-Negotiable Rules:
- All code must be generated by Claude Code
- Manual coding is strictly forbidden
- Specifications are the single source of truth
- Bugs or changes must be fixed by updating specs, not code
- Spec-Driven flow must be followed: Constitution ‚Üí Specify ‚Üí Plan ‚Üí Tasks ‚Üí Implement

Phase 2 Requirements (MANDATORY):
- Implement all Level features as a web application
- Create RESTful API endpoints
- Build a responsive frontend interface
- Store data in Neon Serverless PostgreSQL database
- Implement authentication using Better Auth
- Use JWT (JSON Web Tokens) for authentication and authorization
- Enforce user-specific data isolation

Technology Stack (MUST be stated clearly):
- Frontend: Next.js 16+ (App Router)
- Backend: Python FastAPI
- ORM: SQLModel
- Database: Neon Serverless PostgreSQL
- Authentication: Better Auth
- Tokens: JWT
- Spec-Driven Tooling: Claude Code + Spec-Kit Plus

Security & Architecture Principles to include:
- Stateless authentication using JWT
- Shared secret via BETTER_AUTH_SECRET environment variable
- Backend must verify JWT independently
- Each user can only access their own tasks
- All API endpoints require a valid JWT
- Requests without JWT must return 401 Unauthorized

Out of Scope (EXPLICIT):
- AI / Chatbots
- Kubernetes
- Cloud orchestration
- Background workers
- Admin panels

Output requirements:
- Write ONLY the constitution.md content
- Use clear sections and headings
- Do NOT write any code
- Do NOT invent features outside the requirements

## Response snapshot

Created comprehensive Phase 2 constitution (v2.0.0) with complete architectural transformation from CLI to full-stack web application.

**Key Components Added:**

1. **Core Principles (8 total):**
   - Preserved Principles I-V (adapted for full-stack context)
   - Added Principle VI: Security by Design
   - Added Principle VII: Stateless Authentication
   - Added Principle VIII: User Data Isolation

2. **Technology Stack Section:**
   - Frontend: Next.js 16+ (App Router), TypeScript, Tailwind CSS, Better Auth
   - Backend: Python FastAPI, SQLModel, Pydantic, JWT verification
   - Database: Neon Serverless PostgreSQL, Alembic migrations
   - Authentication: Better Auth + JWT with shared BETTER_AUTH_SECRET

3. **Security Architecture:**
   - Complete authentication flow (7 steps)
   - Required environment variables (DATABASE_URL, BETTER_AUTH_SECRET, etc.)
   - Security checklist (8 verification points)

4. **API Design Principles:**
   - RESTful conventions (/api/v1/ prefix, plural nouns)
   - HTTP method semantics (GET, POST, PUT/PATCH, DELETE)
   - Required status codes (200, 201, 204, 400, 401, 403, 404, 500)
   - JSON request/response format with Pydantic validation

5. **Data Model Rules:**
   - Task entity with user_id foreign key and all Phase 1 attributes
   - UUID primary keys, indexed foreign keys
   - Timestamps (created_at, updated_at) on all tables
   - User entity reference (managed by Better Auth)

6. **Frontend Requirements:**
   - Required pages (landing, login, register, dashboard, tasks)
   - Required components (TaskList, TaskForm, TaskCard, AuthGuard, Navbar)
   - Responsive design breakpoints (mobile 320px, tablet 768px, desktop 1024px)

7. **Backend Requirements:**
   - API endpoints for tasks (GET list, POST create, GET/PUT/DELETE single, PATCH complete)
   - Query parameters (status, priority, tags, sort, order)
   - Required middleware (JWT verification, CORS, validation, error handling)

8. **Quality Standards:**
   - TypeScript strict mode, no `any` types
   - Pydantic models for all schemas
   - Type hints on all functions
   - WCAG 2.1 Level AA accessibility
   - Comprehensive documentation

9. **Explicit Out of Scope:**
   - AI/Chatbot features
   - Kubernetes orchestration
   - Cloud infrastructure code
   - Background workers
   - Admin panels

**Version Change:** 1.2.0 ‚Üí 2.0.0 (MAJOR)

**Rationale for MAJOR bump:** Fundamental architectural transformation with breaking changes (CLI ‚Üí web, in-memory ‚Üí PostgreSQL, single-user ‚Üí multi-user, Python-only ‚Üí TypeScript + Python).

## Outcome

- ‚úÖ Impact: Complete Phase 2 constitution created, enabling full-stack web application development with secure authentication and multi-user support while maintaining SDD principles
- üß™ Tests: Constitutional compliance verified; all requirements from user prompt incorporated; no placeholders remaining
- üìÅ Files: .specify/memory/constitution.md (495 lines, comprehensive coverage)
- üîÅ Next prompts: Feature specification for Phase 2 implementation (authentication system, database setup, API endpoints, frontend UI)
- üß† Reflection: Successfully transformed Phase 1 CLI constraints into Phase 2 full-stack requirements while preserving core SDD principles and adding security-first architecture

## Evaluation notes (flywheel)

- Failure modes observed: None - template followed precisely with all requirements met
- Graders run and results (PASS/FAIL): Constitutional completeness: PASS, Technology stack clarity: PASS, Security requirements: PASS, Out-of-scope explicit: PASS
- Prompt variant (if applicable): N/A (initial Phase 2 constitution)
- Next experiment (smallest change to try): Validate constitution against first Phase 2 feature specification to ensure all necessary constraints and requirements are captured
